<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ch√∫c m·ª´ng sinh nh·∫≠t Nh∆∞ √ù üéÇ</title>
<style>
  :root{
    --bg:#FFF7FF;
    --card:#ffffff;
    --accent:#FF6FB5;
    --accent-2:#FFD166;
  }
  html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  body{
    background: linear-gradient(180deg,#FFF7FF 0%, #F0F8FF 100%);
    overflow:hidden;
    display:flex;align-items:center;justify-content:center;
  }

  /* Container */
  .stage{
    width:100%;
    height:100vh;
    position:relative;
    display:grid;
    place-items:center;
    padding:20px;
    box-sizing:border-box;
  }

  /* Top header */
  .header{
    position:absolute;top:18px;left:50%;transform:translateX(-50%);
    text-align:center;
  }
  .header h1{
    margin:0;font-size:28px;color:#6D2E6F;letter-spacing:1px;
    text-shadow: 0 6px 14px rgba(109,46,111,0.12);
  }
  .header p{margin:6px 0 0;color:#6b6b6b;font-size:14px}

  /* Main card */
  .card{
    width:min(980px,94vw);
    background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.75));
    border-radius:18px; padding:28px;
    box-shadow: 0 10px 30px rgba(108,36,108,0.12);
    display:grid;grid-template-columns: 1fr 420px;gap:20px;align-items:center;
    backdrop-filter: blur(6px);
  }

  /* Left: message & controls */
  .left{
    padding:8px 12px;
  }
  .greeting{
    font-size:20px;color:#3b1a3b;margin:0 0 8px;
  }
  .name{
    font-family: 'Segoe UI', 'Poppins', sans-serif;
    font-size:44px;margin:0;color:var(--accent);
    line-height:1;
    letter-spacing:0.5px;
  }
  .meta{margin-top:8px;color:#666;font-size:14px}

  .controls{margin-top:18px;display:flex;gap:10px;flex-wrap:wrap}
  button.btn{
    border:0;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer;
    box-shadow: 0 6px 12px rgba(99,52,99,0.08);
  }
  .btn-pink{background:linear-gradient(90deg,#FF9CCF,#FF6FB5);color:white;}
  .btn-yellow{background:linear-gradient(90deg,#FFE4A8,#FFD166);color:#5a2d5a;}
  .btn-outline{background:transparent;border:2px solid #f0c; color:#6b2b6b;}

  /* Right: cake + animation */
  .right{
    display:flex;align-items:center;justify-content:center;flex-direction:column;
  }

  .cake{
    width:260px;height:220px;position:relative;
    display:flex;align-items:center;justify-content:center;
  }
  .cake .layer{
    width:220px;height:120px;background:linear-gradient(180deg,#FFDDEB,#FFBFD3);
    border-radius:20px;position:absolute;bottom:30px;box-shadow:0 10px 20px rgba(0,0,0,0.08);
  }
  .cake .top{
    width:160px;height:70px;background:linear-gradient(180deg,#FFF,#FFECEC);
    border-radius:14px;position:absolute;bottom:95px;box-shadow:0 6px 14px rgba(0,0,0,0.06);
  }
  .candles{
    position:absolute;bottom:150px;display:flex;gap:10px;
  }
  .candle{width:8px;height:32px;background:#fff;border-radius:3px;position:relative;overflow:visible;
    border:2px solid rgba(0,0,0,0.03);
  }
  .flame{
    position:absolute;top:-12px;left:50%;transform:translateX(-50%);
    width:12px;height:16px;border-radius:6px;background:radial-gradient(circle at 50% 35%, #FFD479, #FF9B6B);
    filter:drop-shadow(0 4px 6px rgba(255,150,80,0.3));
    animation: flicker 0.9s infinite;
  }
  @keyframes flicker{0%{transform:translateX(-50%) scaleY(1)}50%{transform:translateX(-50%) scaleY(1.08)}100%{transform:translateX(-50%) scaleY(1)}}

  /* Balloon styles */
  .balloon{
    position:absolute;
    bottom:-40px;
    width:64px;height:84px;border-radius:50% 50% 50% 50%/60% 60% 40% 40%;
    display:flex;align-items:flex-end;justify-content:center;
    transform-origin:center bottom;
    animation: floatUp linear infinite;
    box-shadow: inset -8px -10px 24px rgba(0,0,0,0.06);
  }
  .balloon:after{
    content:"";width:2px;height:50px;background:#666;position:absolute;bottom:-36px;
    left:50%;transform:translateX(-50%);opacity:0.2;
  }
  @keyframes floatUp{
    from{transform:translateY(0) rotate(-4deg)}
    to{transform:translateY(-120vh) rotate(6deg)}
  }

  /* Confetti canvas covers whole view */
  #confettiCanvas{
    position:fixed;left:0;top:0;width:100vw;height:100vh;pointer-events:none;z-index:999;
  }

  /* Slideshow modal */
  .modal{
    position:fixed;inset:0;background:rgba(7,6,10,0.55);display:none;align-items:center;justify-content:center;z-index:1200;
  }
  .modal.open{display:flex}
  .slideshow{
    width:min(980px,92vw);height:min(580px,82vh);background:linear-gradient(180deg,#fff7fc,#ffffff);
    border-radius:14px;padding:18px;display:flex;gap:12px;box-shadow:0 20px 40px rgba(32,24,48,0.4);
  }
  .slide-left{flex:1;display:grid;place-items:center;position:relative;overflow:hidden;border-radius:10px;background:#fff}
  .slide-right{width:320px;padding:10px;display:flex;flex-direction:column;gap:8px;}
  .slide img{max-width:100%;height:100%;object-fit:cover;border-radius:8px}
  .caption{font-weight:700;color:#4a1f4a}
  .thumbs{display:flex;gap:6px;margin-top:auto;flex-wrap:wrap}
  .thumb{width:64px;height:48px;background:#f4f4f4;border-radius:8px;overflow:hidden;cursor:pointer;display:flex;align-items:center;justify-content:center}
  .controls-row{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
  .close-x{position:absolute;right:12px;top:10px;background:transparent;border:0;color:#fff;font-size:28px;cursor:pointer}

  /* footer */
  .footer{position:absolute;right:18px;bottom:12px;color:#5a2d5a;font-size:13px}

  /* responsive */
  @media (max-width:920px){
    .card{grid-template-columns:1fr; padding:18px}
    .right{order:-1;margin-bottom:6px}
  }
</style>
</head>
<body>
  <canvas id="confettiCanvas"></canvas>

  <div class="stage" id="stage">
    <div class="header">
      <h1>üéâ Sinh nh·∫≠t vui v·∫ª, Nh∆∞ √ù!</h1>
      <p>M·ª´ng sinh nh·∫≠t l·∫ßn th·ª© <strong id="ageText">25</strong> ‚Äî <span id="dobText">05/11/2000</span></p>
    </div>

    <div class="card" role="main" aria-label="Birthday card">
      <div class="left">
        <p class="greeting">G·ª≠i Nh∆∞ √ù th√¢n m·∫øn,</p>
        <h2 class="name" id="heroName">Nh∆∞ √ù</h2>
        <div class="meta" id="metaText"></div>

        <div class="message">
            "Sinh nh·∫≠t kh√¥ng ch·ªâ l√† th√™m m·ªôt tu·ªïi, m√† l√† th√™m m·ªôt h√†nh tr√¨nh.<br/>
            Ch√∫c b·∫°n ƒëi qua nƒÉm m·ªõi v·ªõi tr√°i tim tr√†n ƒë·∫ßy y√™u th∆∞∆°ng v√† hy v·ªçng."
        </div>

        <div class="controls">
          <!-- <button class="btn btn-pink" id="playSongBtn">üéµ B·∫≠t b√†i h√°t</button> -->
          <button class="btn btn-yellow" id="showVideoBtn">‚ú® ‚ÄúH√†nh tr√¨nh c·ªßa nh·ªØng k·ª∑ ni·ªám ‚Äì c√πng xem nh√©!‚Äù</button>
          <button class="btn btn-outline" id="blowBtn">üí® Th·ªïi n·∫øn</button>
          <!-- <button class="btn" id="confettiBtn" style="background:linear-gradient(90deg,#C8FFF9,#AFE9FF)">üéä Ph√°o gi·∫•y</button> -->
        </div>

      </div>

      <div class="right">
        <div class="cake" aria-hidden="true">
          <div class="layer"></div>
          <div class="top"></div>

          <div class="candles" id="candles">
            <div class="candle"><div class="flame"></div></div>
            <div class="candle"><div class="flame"></div></div>
            <div class="candle"><div class="flame"></div></div>
          </div>
        </div>
        <div style="margin-top:8px;color:#6b6b6b">Nh·∫•n "Th·ªïi n·∫øn" n√†o!</div>
      </div>
    </div>

    <div class="footer">üéà ƒê∆∞·ª£c t·∫°o ri√™ng cho Nh∆∞ √ù ‚Ä¢ M·ª´ng 25 tu·ªïi</div>
  </div>

  <!-- balloons: will be inserted by JS -->
  <!-- slideshow modal -->
  <div class="modal" id="modal">
    <div class="slideshow" role="dialog" aria-modal="true">
      <button class="close-x" id="closeModal">&times;</button>
      <div class="slide-left">
        <div class="slide" id="slideView">
          <img src="" id="slideImg" alt="Slide image" />
        </div>
      </div>
      <div class="slide-right">
        <div>
          <div class="caption" id="slideTitle">Video ch√∫c m·ª´ng</div>
          <div style="color:#6b6b6b;font-size:14px" id="slideDesc">M·ªôt v√†i l·ªùi ch√∫c ng·∫Øn g·ªçn v√† ·∫•m √°p d√†nh cho Nh∆∞ √ù.</div>
        </div>

        <div class="thumbs" id="thumbs"></div>

        <div class="controls-row">
          <button class="btn btn-pink" id="prevSlide">‚óÄ Tr∆∞·ªõc</button>
          <button class="btn btn-yellow" id="nextSlide">Ti·∫øp ‚ñ∂</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* ========== Personalization ===========
   Name: Nh∆∞ √ù
   DOB: 2000-11-05  (YYYY-MM-DD)
   Age is computed automatically.
   =====================================*/
const PERSON = {
  name: "Nh∆∞ √ù",
  dob: "2000-11-05" // yyyy-mm-dd
};

/* Utility: compute age */
function computeAge(dobStr){
  const dob = new Date(dobStr + "T00:00:00");
  const today = new Date(); // browser local time
  let age = today.getFullYear() - dob.getFullYear();
  const m = today.getMonth() - dob.getMonth();
  if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) age--;
  return age;
}

// const age = computeAge(PERSON.dob);

/* Update UI with name & age */
document.getElementById('heroName').textContent = PERSON.name;
document.getElementById('dobText').textContent = (new Date(PERSON.dob)).toLocaleDateString('vi-VN');
document.getElementById('ageText').textContent = 25;
document.getElementById('metaText').innerHTML = `Ch√∫c m·ª´ng sinh nh·∫≠t l·∫ßn <strong>25</strong> ‚Äî Ng√†y ${(new Date(PERSON.dob)).toLocaleDateString('vi-VN')}. Mong m·ªçi ƒëi·ªÅu t·ªët ƒë·∫πp s·∫Ω ƒë·∫øn v·ªõi b·∫°n!`;

/* ========== Balloons ========= */
const stage = document.getElementById('stage');
const colors = ['#FF9CCF','#FFD166','#A2FFCC','#C8FFF9','#B7E0FF','#FFECB3'];
function createBalloon(xPercent, delay, size=64, color){
  const el = document.createElement('div');
  el.className = 'balloon';
  el.style.left = xPercent + '%';
  el.style.width = size + 'px';
  el.style.height = Math.round(size*1.25) + 'px';
  el.style.background = `linear-gradient(180deg, ${color}, ${shadeColor(color, -15)})`;
  el.style.animationDuration = (10 + Math.random()*8) + 's';
  el.style.animationDelay = delay + 's';
  el.style.zIndex = 20;
  stage.appendChild(el);
  // remove after animation ends (approx)
  setTimeout(()=>el.remove(), 22000);
}

/* helper shade */
function shadeColor(hex, percent) {
  // hex like #RRGGBB
  const c = hex.replace('#','');
  const num = parseInt(c,16);
  let r = (num >> 16) + percent;
  let g = ((num >> 8) & 0x00FF) + percent;
  let b = (num & 0x0000FF) + percent;
  r = Math.max(Math.min(255,r),0);
  g = Math.max(Math.min(255,g),0);
  b = Math.max(Math.min(255,b),0);
  return '#' + ( (1<<24) + (r<<16) + (g<<8) + b ).toString(16).slice(1);
}

/* spawn some balloons periodically */
function spawnBalloonsBurst(count=8){
  for(let i=0;i<count;i++){
    const x = Math.random()*100;
    createBalloon(x, Math.random()*1.2, 42 + Math.random()*48, colors[Math.floor(Math.random()*colors.length)]);
  }
}

/* initial balloons */
spawnBalloonsBurst(12);
/* continuous gentle spawn */
setInterval(()=>spawnBalloonsBurst(4), 4200);

/* ========== Confetti (canvas) ========== */
const confettiCanvas = document.getElementById('confettiCanvas');
const ctx = confettiCanvas.getContext('2d');
function resizeCanvas(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

let confettiParticles = [];
function launchConfetti(){
  confettiParticles = [];
  const colors = ['#FF9CCF','#FFD166','#A2FFCC','#C8FFF9','#B7E0FF','#FFECB3'];
  for(let i=0;i<120;i++){
    confettiParticles.push({
      x: Math.random()*confettiCanvas.width,
      y: -20 - Math.random()*200,
      vx: (Math.random()-0.5)*6,
      vy: 2 + Math.random()*6,
      r: 6 + Math.random()*8,
      color: colors[Math.floor(Math.random()*colors.length)],
      rot: Math.random()*360,
      rate: 4 + Math.random()*6,
    });
  }
  animateConfetti();
}
let confettiAnimId = null;
function animateConfetti(){
  if(confettiAnimId) cancelAnimationFrame(confettiAnimId);
  function step(){
    ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
    confettiParticles.forEach((p)=>{
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.04; // gravity
      p.rot += p.rate;
      ctx.save();
      ctx.translate(p.x,p.y);
      ctx.rotate(p.rot * Math.PI/180);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.r/2, -p.r/2, p.r, p.r*0.6);
      ctx.restore();
    });
    // remove offscreen
    confettiParticles = confettiParticles.filter(p=>p.y < confettiCanvas.height + 50);
    if(confettiParticles.length>0){
      confettiAnimId = requestAnimationFrame(step);
    } else {
      cancelAnimationFrame(confettiAnimId);
      confettiAnimId = null;
      ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
    }
  }
  step();
}

/* ========== Slideshow (video-like) ========== */
/* Default slides ‚Äî replace 'src' with your images (relative paths or data URLs) */
const slides = [
  { 
    src: "images/D1.jpg", 
    title: "Ng√†y ƒë·∫ßu ti√™n g·∫∑p Nh∆∞ √ù", 
    desc: "Kho·∫£nh kh·∫Øc ƒë·∫ßu ti√™n ·∫•y t∆∞·ªüng ch·ª´ng b√¨nh th∆∞·ªùng, nh∆∞ng l·∫°i m·ªü ra m·ªôt h√†nh tr√¨nh ƒë·∫ßy ·∫Øp ti·∫øng c∆∞·ªùi v√† k·ª∑ ni·ªám."
  },
  { 
    src: "images/D2.jpg", 
    title: "Ch·∫∑ng ƒë∆∞·ªùng b√™n nhau", 
    desc: "Th·ªùi gian tr√¥i qua, ch√∫ng ta c√πng s·∫ª chia bao bu·ªìn vui, ƒë·ªÉ t√¨nh b·∫°n d·∫ßn tr·ªü th√†nh ƒëi·ªÅu qu√Ω gi√° nh·∫•t."
  },
  { 
    src: "images/HaTien.jpg", 
    title: "Nh·ªØng chuy·∫øn ƒëi tuy·ªát v·ªùi", 
    desc: "H√† Ti√™n ‚Äì n∆°i ƒë√°nh d·∫•u nh·ªØng ng√†y rong ru·ªïi, nh·ªØng ti·∫øng c∆∞·ªùi gi√≤n tan v√† nh·ªØng b·ª©c ·∫£nh ch·∫≥ng th·ªÉ n√†o qu√™n."
  },
  { 
    src: "images/QPAN.jpg", 
    title: "Kho·∫£nh kh·∫Øc h·ªçc ƒë∆∞·ªùng", 
    desc: "T·ª´ nh·ªØng bu·ªïi h·ªçc qu·ªëc ph√≤ng ƒë·∫øn gi·ªù ngh·ªâ tr∆∞a r·ªôn r√£, t·∫•t c·∫£ ƒë·ªÅu tr·ªü th√†nh k√Ω ·ª©c kh√¥ng th·ªÉ thay th·∫ø."
  },
  { 
    src: "images/Game.jpg", 
    title: "Ho·∫°t ƒë·ªông vui ch∆°i", 
    desc: "Nh·ªØng l·∫ßn c√πng nhau 'chi·∫øn game', c√πng h√≤ h√©t v√† c∆∞·ªùi s·∫£ng kho√°i ‚Äì v√¨ tu·ªïi tr·∫ª l√† nh∆∞ th·∫ø, ƒë·∫ßy nƒÉng l∆∞·ª£ng v√† h·ªìn nhi√™n."
  },
  { 
    src: "images/AnCuoi.jpg", 
    title: "Nh·ªØng kho·∫£nh kh·∫Øc vui v·∫ª", 
    desc: "Ng√†y d·ª± ti·ªác c∆∞·ªõi b·∫°n Loan ‚Äì th√™m m·ªôt k·ª∑ ni·ªám lung linh trong b·ª©c tranh thanh xu√¢n ƒë·∫ßy s·∫Øc m√†u."
  },
  { 
    src: "images/BungMam.jpg", 
    title: "Nh·ªØng kho·∫£nh kh·∫Øc ƒë√°ng nh·ªõ", 
    desc: "Kho·∫£nh kh·∫Øc b∆∞ng m√¢m, ti·∫øng c∆∞·ªùi vang l√™n gi·ªØa b·∫°n b√® th√¢n th∆∞∆°ng ‚Äì nh·ªØng ƒëi·ªÅu nh·ªè b√© m√† ·∫•m l√≤ng bi·∫øt bao."
  },
  { 
    src: "images/NewYear.jpg", 
    title: "H√†nh tr√¨nh nƒÉm m·ªõi", 
    desc: "NƒÉm m·ªõi, ni·ªÅm vui m·ªõi ‚Äì nh∆∞ng t√¨nh b·∫°n v·∫´n nguy√™n v·∫πn nh∆∞ thu·ªü ban ƒë·∫ßu, c√πng nhau vi·∫øt ti·∫øp nh·ªØng c√¢u chuy·ªán ƒë·∫πp."
  },
  { 
    src: "images/TNY.jpg", 
    title: "L·ªùi ch√∫c ·∫•m √°p", 
    desc: `Ch√∫c ${PERSON.name} lu√¥n h·∫°nh ph√∫c, r·∫°ng r·ª° v√† gi·ªØ m√£i n·ª• c∆∞·ªùi t∆∞∆°i nh∆∞ ng√†y ƒë·∫ßu g·∫∑p g·ª°. H√¥m nay l√† ng√†y c·ªßa b·∫°n ‚Äì h√£y s·ªëng th·∫≠t vui, th·∫≠t h·∫øt m√¨nh, v√¨ b·∫°n x·ª©ng ƒë√°ng v·ªõi t·∫•t c·∫£ y√™u th∆∞∆°ng n√†y! üéàüéÇ`
  }
];


const modal = document.getElementById('modal');
const slideImg = document.getElementById('slideImg');
const slideTitle = document.getElementById('slideTitle');
const slideDesc = document.getElementById('slideDesc');
const thumbs = document.getElementById('thumbs');
let idx = 0;
let autoSlideTimer = null;

/* ========== Hi·ªáu ·ª©ng ƒë·∫øm ng∆∞·ª£c tr∆∞·ªõc khi show slideshow ========== */
function showCountdown(callback) {
  const audio = document.getElementById('1-2-3');
  audio.play();
  const countdown = document.createElement('div');
  countdown.id = 'countdown';
  countdown.style.position = 'fixed';
  countdown.style.inset = '0';
  countdown.style.display = 'flex';
  countdown.style.alignItems = 'center';
  countdown.style.justifyContent = 'center';
  countdown.style.fontSize = '8rem';
  countdown.style.fontWeight = '700';
  countdown.style.color = '#fff';
  countdown.style.background = 'rgba(0,0,0,0.7)';
  countdown.style.zIndex = '9999';
  document.body.appendChild(countdown);

  let num = 3;
  countdown.textContent = num;

  const interval = setInterval(() => {
    num--;
    if (num > 0) {
      countdown.textContent = num;
      countdown.animate([{ transform: "scale(1)" }, { transform: "scale(1.5)", opacity: 0.5 }, { transform: "scale(1)" }], { duration: 700 });
    } else {
      clearInterval(interval);
      countdown.remove();
      callback?.();
    }
  }, 1000);
}

/* ========== Hi·ªÉn th·ªã slideshow ========== */
function openSlideshow(i = 0) {
  showCountdown(() => {
    idx = i;
    updateSlide();
    modal.classList.add('open');
    playHappyBirthday();
    startAutoSlide();
  });
}

function closeSlideshow() {
  modal.classList.remove('open');
  stopAutoSlide();
  const audio = document.getElementById('birthdaySong');
  if (audio) {
    audio.pause();
    audio.currentTime = 0;
  }
}

/* ========== N√∫t ƒëi·ªÅu h∆∞·ªõng ========== */
document.getElementById('showVideoBtn').addEventListener('click', () => openSlideshow(0));
document.getElementById('closeModal').addEventListener('click', closeSlideshow);
document.getElementById('prevSlide').addEventListener('click', () => {
  idx = (idx - 1 + slides.length) % slides.length;
  updateSlide();
});
document.getElementById('nextSlide').addEventListener('click', () => {
  idx = (idx + 1) % slides.length;
  updateSlide();
});

/* ========== C·∫≠p nh·∫≠t slide hi·ªán t·∫°i ========== */
function updateSlide() {
  const s = slides[idx];
  slideImg.src = s.src;
  slideTitle.textContent = s.title || "L·ªùi ch√∫c";
  slideDesc.textContent = s.desc || "";
  Array.from(thumbs.children).forEach((c, i) => {
    c.style.outline = (i === idx) ? "3px solid rgba(255,107,181,0.4)" : "none";
  });
}

/* ========== T·ª± ƒë·ªông chuy·ªÉn slide ========== */
function startAutoSlide() {
  stopAutoSlide(); 
  autoSlideTimer = setInterval(() => {
    idx = (idx + 1) % slides.length;
    updateSlide();
  }, 5000); 
}

function stopAutoSlide() {
  if (autoSlideTimer) clearInterval(autoSlideTimer);
}

/* ========== Sinh thumbnail ========== */
slides.forEach((s, i) => {
  const t = document.createElement('div');
  t.className = 'thumb';
  const img = document.createElement('img');
  img.src = s.src;
  img.style.width = '100%';
  img.style.height = '100%';
  img.style.objectFit = 'cover';
  t.appendChild(img);
  t.addEventListener('click', () => {
    idx = i;
    updateSlide();
  });
  thumbs.appendChild(t);
});

/* Auto-play slideshow when open? We'll keep manual to respect user control. */

/* ========== Cake candle blow effect ========== */
const blowBtn = document.getElementById('blowBtn');
blowBtn.addEventListener('click', ()=> {
  playBirthdaySoundEffect();
  // hide flames
  document.querySelectorAll('.flame').forEach(f=>{
    f.style.transition = 'transform 800ms ease, opacity 600ms';
    f.style.transform = 'scaleY(0.05)';
    f.style.opacity = '0';
  });
  // spawn many gentle balloons from cake
  spawnBalloonsBurst(16);
  // small confetti
  launchConfetti();
  // brief sparkle on cake
  const cake = document.querySelector('.cake');
  cake.animate([{filter:'brightness(1)'},{filter:'brightness(1.35)'},{filter:'brightness(1)'}],{duration:900});
});

/* ========== Confetti button ========= */
document.getElementById('confettiBtn').addEventListener('click', ()=>launchConfetti());

/* ========== Play simple melody using WebAudio ========= */
const playBtn = document.getElementById('playSongBtn');
let audioCtx = null;
function playHappyBirthday(){
  const audio = document.getElementById("birthdaySong");
  if (audio) {
    audio.currentTime = 0;
    audio.play().catch(err => {
      console.warn("Kh√¥ng th·ªÉ ph√°t nh·∫°c t·ª± ƒë·ªông, c·∫ßn t∆∞∆°ng t√°c ng∆∞·ªùi d√πng tr∆∞·ªõc:", err);
    });
  }
}

function playBirthdaySoundEffect(){
  const audio = document.getElementById("birthdaySoundEffect");
  if (audio) {
    audio.currentTime = 0;
    audio.play().catch(err => {
      console.warn("Kh√¥ng th·ªÉ ph√°t nh·∫°c t·ª± ƒë·ªông, c·∫ßn t∆∞∆°ng t√°c ng∆∞·ªùi d√πng tr∆∞·ªõc:", err);
    });
  }
}

/* play with user gesture */
playBtn.addEventListener('click', ()=>{
  try{
    playHappyBirthday();
    // also spawn some balloons
    spawnBalloonsBurst(10);
  }catch(e){ console.warn(e) }
});

/* ========== small accessibility / keyboard shortcuts ========= */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape') closeSlideshow();
  if(e.key === 'v') openSlideshow(0);
  if(e.key === 'm') playHappyBirthday();
});

/* ========== small cleanup: remove old balloons to avoid memory leak =======*/
setInterval(()=>{
  // keep stage children under a limit
  const balloons = stage.querySelectorAll('.balloon');
  if(balloons.length > 80){
    balloons.forEach((b,i)=>{ if(i<20) b.remove(); });
  }
}, 6000);

</script>
<audio id="birthdaySong" src="music/happy-birthday.mp3" preload="auto"></audio>
<audio id="birthdaySoundEffect" src="music/HBBD-Sound-Effect.mp3" preload="auto"></audio>
<audio id="1-2-3" src="music/1-2-3.mp3" preload="auto"></audio>
</body>
</html>
